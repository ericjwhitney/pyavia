"""
Reference propeller 5868-9 from NACA Report No. 658, note:
    - All units in this example are slug, ft, s unless noted otherwise.
    - B = 3 blades.
    - R = 5.0' / 1.524 m.
    - Local incidence angle βr corresponds to the case where β=0° at
      x=0.75.  This was determined by subtracting β0=35° from the
      data which gives the overall angle.
    - Tip chord if refined by assuming it to be a semiellipse outboard
      of 0.95R, with additional stations 0.975R and 1.000R added:
        * 0.975R chord selected to match semiellipse equation with
          axes a = 0.05R, b/R = b/D_0.95 × 2.
        * 1.000R chord selected to give correct area of the tip A_T =
          0.5.π.a.b.
    - Tip angle is linear continuation of the 35° pitch data (per report
      text).
    - Report quotes aerofoil section as Clark-Y for both propellers,
      although note that thickness appears to have been scaled.
    - Thickness is an asymptotic linear extrapolation at the tip.  Root
      is circular giving h/b = 1, value for 0.25R is interpolated
      linearly.
"""
# Written by Eric J. Whitney, January 2023.

import numpy as np

# == Geometry ==========================================================

_5868_9_GEO = np.array([
    # r [ft], c [ft], t [ft], βr [°]
    [1.0000, 0.3650, 0.3650, 21.44],
    [1.2500, 0.4480, 0.3046, 19.27],
    [1.5000, 0.5330, 0.1919, 16.82],
    [1.7500, 0.6130, 0.1471, 14.30],
    [2.0000, 0.6950, 0.1209, 11.65],
    [2.2500, 0.7430, 0.1033, 8.89],
    [2.5000, 0.7600, 0.0904, 6.56],
    [2.7500, 0.7540, 0.0822, 4.68],
    [3.0000, 0.7320, 0.0747, 3.20],
    [3.2500, 0.7000, 0.0679, 2.01],
    [3.5000, 0.6600, 0.0614, 0.95],
    [3.7500, 0.6140, 0.0553, 0.00],
    [4.0000, 0.5630, 0.0490, -0.84],
    [4.2500, 0.5090, 0.0433, -1.70],
    [4.5000, 0.4500, 0.0374, -2.49],
    [4.7500, 0.3840, 0.0311, -3.25],
    [4.8750, 0.3326, 0.0266, -3.59],
    [5.0000, 0.1573, 0.0124, -3.91]])

# Convert to separate lists.
r = _5868_9_GEO[:, 0].tolist()
c = _5868_9_GEO[:, 1].tolist()
βr = np.deg2rad(_5868_9_GEO[:, 3]).tolist()

# Constants.
B = 3  # No. of blades.
β0_range = (np.deg2rad(15.0), np.deg2rad(60))  # Published test range.
R = r[-1]
ρ = 0.002377  # [slug/ft³]
a = 1116.45  # [fps]
μ = 3.78456e-7  # [lbf.s/ft²]

# == Test Data =========================================================

DATA_SETS = {
    # {β0 [°] @ x=0.75: [[Data Row 1], [Data Row 2], [...]]}.
    # Rows: J,     η,    C_T,   C_P,   RPM,    V∞ [fps]
    15: [[0.000, 0.000, 0.140, 0.060, 1000.0, 0.00],
         [0.200, 0.420, 0.116, 0.058, 1000.0, 33.33],
         [0.400, 0.665, 0.083, 0.050, 1000.0, 66.67],
         [0.500, 0.752, 0.065, 0.043, 1000.0, 83.33],
         [0.600, 0.805, 0.045, 0.034, 1000.0, 100.00],
         [0.650, 0.817, 0.034, 0.028, 1000.0, 108.33],
         [0.700, 0.803, 0.024, 0.022, 1000.0, 116.67],
         [0.725, 0.775, 0.019, 0.018, 1000.0, 120.83],
         [0.750, 0.710, 0.014, 0.015, 1000.0, 125.00],
         [0.800, 0.340, 0.003, 0.007, 1000.0, 133.33],
         [0.810, 0.000, 0.000, 0.003, 1000.0, 135.00]],

    25: [[0.000, 0.000, 0.160, 0.149, 800.0, 0.00],
         [0.200, 0.238, 0.155, 0.137, 800.0, 26.67],
         [0.400, 0.475, 0.152, 0.126, 800.0, 53.33],
         [0.500, 0.600, 0.146, 0.122, 800.0, 66.67],
         [0.600, 0.690, 0.134, 0.117, 800.0, 80.00],
         [0.700, 0.755, 0.119, 0.110, 800.0, 93.33],
         [0.800, 0.803, 0.100, 0.100, 800.0, 106.67],
         [0.900, 0.841, 0.080, 0.087, 800.0, 120.00],
         [1.000, 0.861, 0.060, 0.070, 800.0, 133.33],
         [1.050, 0.863, 0.050, 0.060, 800.0, 140.00],
         [1.100, 0.860, 0.039, 0.050, 800.0, 146.67],
         [1.150, 0.840, 0.029, 0.038, 800.0, 153.33],
         [1.200, 0.786, 0.018, 0.026, 800.0, 160.00],
         [1.250, 0.660, 0.008, 0.014, 800.0, 166.67],
         [1.275, 0.500, 0.003, 0.007, 793.7, 168.67],
         [1.285, 0.000, 0.000, 0.004, 787.6, 168.67]],

    35: [[0.000, 0.000, 0.174, 0.263, 800.0, 0.00],
         [0.300, 0.208, 0.167, 0.244, 800.0, 40.00],
         [0.600, 0.425, 0.159, 0.223, 800.0, 80.00],
         [0.800, 0.580, 0.154, 0.210, 800.0, 106.67],
         [0.900, 0.665, 0.152, 0.205, 800.0, 120.00],
         [1.000, 0.732, 0.145, 0.198, 800.0, 133.33],
         [1.100, 0.778, 0.134, 0.188, 800.0, 146.67],
         [1.200, 0.807, 0.118, 0.174, 800.0, 160.00],
         [1.300, 0.827, 0.102, 0.157, 741.6, 160.67],
         [1.400, 0.843, 0.084, 0.135, 692.9, 161.67],
         [1.500, 0.850, 0.065, 0.111, 650.7, 162.67],
         [1.600, 0.845, 0.046, 0.084, 613.8, 163.67],
         [1.650, 0.820, 0.037, 0.070, 598.8, 164.67],
         [1.700, 0.770, 0.027, 0.054, 584.7, 165.67],
         [1.750, 0.680, 0.017, 0.040, 571.4, 166.67],
         [1.800, 0.460, 0.008, 0.023, 558.9, 167.67],
         [1.835, 0.000, 0.000, 0.012, 551.5, 168.67]],

    55: [[0.000, 0.000, 0.159, 0.482, 600.0, 0.00],
         [0.600, 0.205, 0.169, 0.492, 600.0, 60.00],
         [0.750, 0.257, 0.170, 0.492, 600.0, 75.00],
         [0.900, 0.307, 0.168, 0.488, 600.0, 90.00],
         [1.000, 0.341, 0.166, 0.484, 600.0, 100.00],
         [1.200, 0.405, 0.161, 0.475, 600.0, 120.00],
         [1.400, 0.470, 0.155, 0.461, 600.0, 140.00],
         [1.600, 0.532, 0.153, 0.454, 600.0, 160.00],
         [1.800, 0.597, 0.153, 0.460, 562.2, 168.67],
         [2.000, 0.664, 0.154, 0.461, 506.0, 168.67],
         [2.200, 0.732, 0.158, 0.474, 460.0, 168.67],
         [2.300, 0.760, 0.157, 0.474, 440.0, 168.67],
         [2.400, 0.778, 0.153, 0.470, 421.7, 168.67],
         [2.500, 0.787, 0.145, 0.460, 404.8, 168.67],
         [2.600, 0.793, 0.135, 0.444, 389.2, 168.67],
         [2.700, 0.796, 0.124, 0.421, 374.8, 168.67],
         [2.800, 0.794, 0.112, 0.399, 361.4, 168.67],
         [2.900, 0.785, 0.100, 0.373, 349.0, 168.67],
         [3.000, 0.768, 0.088, 0.347, 337.3, 168.67],
         [3.100, 0.747, 0.077, 0.320, 326.5, 168.67],
         [3.200, 0.718, 0.065, 0.290, 316.3, 168.67],
         [3.300, 0.676, 0.052, 0.260, 306.7, 168.67],
         [3.400, 0.615, 0.040, 0.228, 297.7, 168.67],
         [3.500, 0.510, 0.028, 0.197, 289.1, 168.67],
         [3.600, 0.340, 0.015, 0.164, 281.1, 168.67],
         [3.730, 0.000, 0.000, 0.123, 271.3, 168.67]]
}
